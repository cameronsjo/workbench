openapi: 3.0.3
info:
  title: API Name
  description: |
    API description goes here.

    ## Overview
    Brief overview of what this API does.

    ## Authentication
    Describe authentication requirements.

    ## Rate Limiting
    Describe rate limiting policies.
  version: 1.0.0
  contact:
    name: API Support
    email: api-support@example.com
    url: https://developer.example.com
  license:
    name: Proprietary
    url: https://example.com/licenses

servers:
  - url: https://api.example.com
    description: Production server
  - url: https://api-staging.example.com
    description: Staging server
  - url: https://api-dev.example.com
    description: Development server

tags:
  - name: users
    description: User management operations
  - name: health
    description: Health check endpoints

paths:
  /v1/health:
    get:
      summary: Health check
      description: Returns the health status of the API
      operationId: getHealth
      tags:
        - health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy]
                    example: healthy
                  version:
                    type: string
                    example: 1.0.0
        '503':
          $ref: '#/components/responses/503ServiceUnavailable'

  /v1/users:
    get:
      summary: List users
      description: Retrieve a paginated list of users
      operationId: listUsers
      tags:
        - users
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/PageToken'
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserList'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '401':
          $ref: '#/components/responses/401Unauthorized'
        '500':
          $ref: '#/components/responses/500InternalServerError'

    post:
      summary: Create user
      description: Create a new user
      operationId: createUser
      tags:
        - users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreateRequest'
      responses:
        '201':
          description: User created successfully
          headers:
            Location:
              description: URI of the created resource
              schema:
                type: string
                format: uri
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '401':
          $ref: '#/components/responses/401Unauthorized'
        '422':
          $ref: '#/components/responses/422UnprocessableEntity'
        '500':
          $ref: '#/components/responses/500InternalServerError'

  /v1/users/{user_id}:
    parameters:
      - $ref: '#/components/parameters/UserId'

    get:
      summary: Get user
      description: Retrieve a specific user by ID
      operationId: getUser
      tags:
        - users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/401Unauthorized'
        '404':
          $ref: '#/components/responses/404NotFound'
        '500':
          $ref: '#/components/responses/500InternalServerError'

    put:
      summary: Update user
      description: Replace a user's data
      operationId: updateUser
      tags:
        - users
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IfMatch'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '204':
          description: User updated successfully
        '200':
          description: User updated successfully (with Prefer header)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '401':
          $ref: '#/components/responses/401Unauthorized'
        '404':
          $ref: '#/components/responses/404NotFound'
        '412':
          $ref: '#/components/responses/412PreconditionFailed'
        '500':
          $ref: '#/components/responses/500InternalServerError'

    patch:
      summary: Partially update user
      description: Update specific fields of a user using JSON Patch
      operationId: patchUser
      tags:
        - users
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IfMatch'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/JSONPatch'
      responses:
        '204':
          description: User updated successfully
        '200':
          description: User updated successfully (with Prefer header)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/400BadRequest'
        '401':
          $ref: '#/components/responses/401Unauthorized'
        '404':
          $ref: '#/components/responses/404NotFound'
        '412':
          $ref: '#/components/responses/412PreconditionFailed'
        '500':
          $ref: '#/components/responses/500InternalServerError'

    delete:
      summary: Delete user
      description: Delete a user
      operationId: deleteUser
      tags:
        - users
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IfMatch'
      responses:
        '204':
          description: User deleted successfully
        '401':
          $ref: '#/components/responses/401Unauthorized'
        '404':
          $ref: '#/components/responses/404NotFound'
        '412':
          $ref: '#/components/responses/412PreconditionFailed'
        '500':
          $ref: '#/components/responses/500InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from authentication endpoint

  parameters:
    UserId:
      name: user_id
      in: path
      required: true
      description: Unique identifier of the user
      schema:
        type: string
        format: uuid

    PageSize:
      name: page_size
      in: query
      description: Number of items per page (max 100)
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10

    PageToken:
      name: page_token
      in: query
      description: Token for retrieving the next page
      schema:
        type: string
        minLength: 1
        maxLength: 2048

    IfMatch:
      name: If-Match
      in: header
      description: ETag for optimistic concurrency control
      required: true
      schema:
        type: string
        minLength: 1

  schemas:
    User:
      type: object
      required:
        - id
        - email_address
        - display_name
        - create_time
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the user
          readOnly: true
          example: 550e8400-e29b-41d4-a716-446655440000
        email_address:
          type: string
          format: email
          minLength: 3
          maxLength: 254
          description: User's email address
          example: user@example.com
        display_name:
          type: string
          minLength: 1
          maxLength: 255
          description: User's display name
          example: John Smith
        first_name:
          type: string
          minLength: 1
          maxLength: 140
          description: User's first name
          example: John
        last_name:
          type: string
          minLength: 1
          maxLength: 140
          description: User's last name
          example: Smith
        phone_number:
          $ref: '#/components/schemas/PhoneNumber'
        state:
          type: string
          enum:
            - ACTIVE
            - SUSPENDED
            - DELETED
          description: Current state of the user account
          example: ACTIVE
        create_time:
          type: string
          format: date-time
          description: Timestamp when user was created (RFC 3339)
          readOnly: true
          example: 2024-01-12T00:00:00Z
        update_time:
          type: string
          format: date-time
          description: Timestamp when user was last updated (RFC 3339)
          readOnly: true
          example: 2024-01-12T00:00:00Z
        links:
          type: array
          description: HATEOAS links for related operations
          readOnly: true
          items:
            $ref: '#/components/schemas/Link'

    UserCreateRequest:
      type: object
      required:
        - email_address
        - display_name
      properties:
        email_address:
          type: string
          format: email
          minLength: 3
          maxLength: 254
          description: User's email address
          example: user@example.com
        display_name:
          type: string
          minLength: 1
          maxLength: 255
          description: User's display name
          example: John Smith
        first_name:
          type: string
          minLength: 1
          maxLength: 140
          description: User's first name
          example: John
        last_name:
          type: string
          minLength: 1
          maxLength: 140
          description: User's last name
          example: Smith
        phone_number:
          $ref: '#/components/schemas/PhoneNumber'

    UserList:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          description: Array of users in this page
          items:
            $ref: '#/components/schemas/User'
        total_items:
          type: integer
          minimum: 0
          maximum: 2147483647
          description: Total number of users in the collection
          example: 100
        page_size:
          type: integer
          minimum: 1
          maximum: 100
          description: Number of items per page
          example: 10
        next_page_token:
          type: string
          minLength: 1
          maxLength: 2048
          description: Token for retrieving the next page
          example: eyJpZCI6IjEyMyJ9
        next_page:
          type: boolean
          description: Whether more pages are available
          example: true

    PhoneNumber:
      type: object
      required:
        - national_number
      properties:
        country_code:
          type: string
          minLength: 1
          maxLength: 3
          pattern: '^[0-9]{1,3}$'
          description: Country calling code
          example: '1'
        national_number:
          type: string
          minLength: 1
          maxLength: 14
          pattern: '^[0-9]+$'
          description: National phone number without country code
          example: '4155551234'

    Link:
      type: object
      required:
        - href
        - rel
        - method
      properties:
        href:
          type: string
          format: uri
          minLength: 1
          maxLength: 2048
          description: URI of the linked resource
          example: https://api.example.com/v1/users/123
        rel:
          type: string
          minLength: 1
          maxLength: 50
          description: Link relation type
          example: self
        method:
          type: string
          enum:
            - GET
            - POST
            - PUT
            - PATCH
            - DELETE
          description: HTTP method for the link
          example: GET

    JSONPatch:
      type: object
      required:
        - op
        - path
      properties:
        op:
          type: string
          enum:
            - add
            - remove
            - replace
            - move
            - copy
            - test
          description: Operation to perform
          example: replace
        path:
          type: string
          minLength: 1
          description: JSON Pointer to target location
          example: /display_name
        value:
          description: Value for add/replace/test operations
          example: Jane Smith
        from:
          type: string
          minLength: 1
          description: JSON Pointer for move/copy operations

    ProblemDetail:
      type: object
      title: Problem Detail
      description: RFC 9457 compliant error response
      required:
        - type
        - title
        - trace_id
      properties:
        type:
          type: string
          format: uri
          description: URI reference identifying the problem type
          example: https://uri.walmart.com/errors/invalid-request
        title:
          type: string
          description: Short, human-readable summary of the problem type
          example: Request is not well-formed, syntactically incorrect, or violates schema.
        status:
          type: integer
          minimum: 400
          maximum: 599
          description: HTTP status code for this occurrence of the problem
          example: 400
        detail:
          type: string
          description: Human-readable explanation specific to this occurrence
          example: The email_address field is required
        instance:
          type: string
          format: uri-reference
          description: URI reference identifying the specific occurrence
          example: /v1/users/123
        trace_id:
          type: string
          description: Correlation and tracing identifier
          example: 90957fca61718
        errors:
          type: array
          description: Array of detailed validation errors
          items:
            $ref: '#/components/schemas/ValidationError'

    ValidationError:
      type: object
      required:
        - code
        - reason
        - property
        - location
      properties:
        code:
          type: string
          format: uri
          description: URI identifying the specific error code
          example: https://uri.walmart.com/errors/missing-required-property
        reason:
          type: string
          description: Human-readable explanation of the error
          example: A required field is missing.
        property:
          type: string
          description: JSON Pointer to the field in error
          example: /email_address
        location:
          type: string
          enum:
            - body
            - query
            - path
            - header
          description: Location of the field in the request
          example: body

  responses:
    400BadRequest:
      description: Bad Request - Request is not well-formed or violates schema
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetail'
          example:
            type: https://uri.walmart.com/errors/invalid-request
            title: Request is not well-formed, syntactically incorrect, or violates schema.
            status: 400
            trace_id: 90957fca61718
            errors:
              - code: https://uri.walmart.com/errors/missing-required-property
                reason: A required field is missing.
                property: /email_address
                location: body

    401Unauthorized:
      description: Unauthorized - Authentication failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetail'
          example:
            type: https://uri.walmart.com/errors/authentication-failure
            title: Authentication failed due to invalid credentials.
            status: 401
            trace_id: 90957fca61718

    403Forbidden:
      description: Forbidden - Authorization failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetail'
          example:
            type: https://uri.walmart.com/errors/authorization-failure
            title: Authorization failed due to insufficient permissions.
            status: 403
            trace_id: 90957fca61718

    404NotFound:
      description: Not Found - Resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetail'
          example:
            type: https://uri.walmart.com/errors/resource-not-found
            title: The specified resource does not exist.
            status: 404
            trace_id: 90957fca61718

    412PreconditionFailed:
      description: Precondition Failed - Resource has changed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetail'
          example:
            type: https://uri.walmart.com/errors/precondition-failure
            title: Update failed. Resource has changed on the server.
            status: 412
            trace_id: 90957fca61718

    422UnprocessableEntity:
      description: Unprocessable Entity - Semantic validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetail'
          example:
            type: https://uri.walmart.com/errors/unprocessable-entity
            title: The request cannot be processed due to semantic errors.
            status: 422
            detail: Cannot activate a user that is already active
            trace_id: 90957fca61718

    500InternalServerError:
      description: Internal Server Error - Unexpected error occurred
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetail'
          example:
            type: https://uri.walmart.com/errors/internal-server-error
            title: An internal server error has occurred.
            status: 500
            trace_id: 90957fca61718

    503ServiceUnavailable:
      description: Service Unavailable - Service is temporarily unavailable
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetail'
          example:
            type: https://uri.walmart.com/errors/service-unavailable
            title: Service Unavailable.
            status: 503
            trace_id: 90957fca61718
